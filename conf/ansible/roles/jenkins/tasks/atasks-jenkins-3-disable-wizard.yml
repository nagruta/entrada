---
- name: get admin password autogenerated post-install
  shell: cat /var/lib/jenkins/secrets/initialAdminPassword
  register: adminpwd
  changed_when: no

# from: https://knowledgevault-sharing.blogspot.com/2018/03/set-up-jenkins-with-ansible.html
- name: complete setup wizard
  jenkins_script:
    script: |
      import static jenkins.model.Jenkins.instance as jenkins
      import jenkins.install.InstallState
      if (!jenkins.installState.isSetupComplete()) {
        InstallState.INITIAL_SETUP_COMPLETED.initializeState()
      }
    user: admin
    password: "{{ adminpwd.stdout }}"
